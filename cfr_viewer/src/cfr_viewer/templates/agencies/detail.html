{% extends "base.html" %}
{% from "components/change_cell.html" import change_cell %}
{% from "components/table_filter.html" import table_filter %}

{% block title %}{{ agency.name if agency else "Agency Not Found" }} - Lens{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ul>
        <li><a href="{{ url_for('agencies.index', year=year) }}">Agencies</a></li>
        <li>{{ agency.name if agency else "Not Found" }}</li>
    </ul>
</nav>

{% if agency %}
<hgroup>
    <h1>{{ agency.name }}</h1>
    {% if agency.short_name %}
    <p>{{ agency.short_name }}</p>
    {% endif %}
</hgroup>

<h2>CFR Chapters</h2>

{% if chapter_stats %}
<div class="filter-toolbar">
    {{ table_filter("chapters-table", "0,1", "Filter by title or chapter...") }}
    {% include "components/year_selector.html" %}
</div>
<table class="striped sortable" id="chapters-table">
    <thead>
        <tr>
            <th scope="col" data-sort="number">Title</th>
            <th scope="col" data-sort="string">Chapter</th>
            <th scope="col" class="numeric" data-sort="number" data-sort-default="desc">Word Count</th>
            <th scope="col" class="numeric" data-sort="number">{{ "To" if year and year < BASELINE_YEAR else "Since" }} {{ BASELINE_YEAR }}</th>
        </tr>
    </thead>
    <tbody>
        {% for ch in chapter_stats %}
        <tr>
            <td data-value="{{ ch.title }}"><a href="{{ url_for('browse.title', title_num=ch.title) }}#chapter-{{ ch.chapter }}">{{ ch.title }}</a></td>
            <td><a href="{{ url_for('browse.title', title_num=ch.title) }}#chapter-{{ ch.chapter }}">{{ ch.chapter }}</a></td>
            <td class="numeric" data-value="{{ ch.word_count }}">{{ "{:,}".format(ch.word_count) }}</td>
            {{ change_cell(ch.change_pct, show_new=true) }}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No CFR chapters associated with this agency.</p>
{% endif %}

{% else %}
<h1>Agency Not Found</h1>
<p>The requested agency could not be found.</p>
{% endif %}
{% endblock %}
