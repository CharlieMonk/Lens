{% extends "base.html" %}
{% from "compare/macros.html" import word_count_display, diff_legend, banner, version_card %}

{% block title %}Compare Sections - Lens{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ul>
        <li><a href="{{ url_for('compare.index') }}">Compare</a></li>
        <li>Section Comparison</li>
    </ul>
</nav>

<hgroup>
    <h1>Compare Sections</h1>
    <p>Side-by-side comparison of {{ title1 }} CFR &sect; {{ section1 }} and {{ title2 }} CFR &sect; {{ section2 }}</p>
</hgroup>

{% if s1 and s2 %}
{% if not has_changes %}
{{ banner("&#x2713;", "Identical Content", "These two sections have identical text content.", class="no-changes") }}
{% else %}
{{ diff_legend("Only in " ~ title1 ~ " CFR &sect; " ~ section1, "Only in " ~ title2 ~ " CFR &sect; " ~ section2) }}
{% endif %}

<div class="grid compare-versions">
    {{ version_card(
        section=s1,
        label=title1 ~ " CFR &sect; " ~ section1,
        link=url_for('browse.section', title_num=title1, section=section1, year=year),
        show_heading=True,
        diff_html=old_html,
        has_changes=has_changes,
        legend_label="Unique" if has_changes else None,
        class="version-old"
    ) }}

    {{ version_card(
        section=s2,
        label=title2 ~ " CFR &sect; " ~ section2,
        link=url_for('browse.section', title_num=title2, section=section2, year=year),
        show_heading=True,
        diff_html=new_html,
        has_changes=has_changes,
        legend_label="Unique" if has_changes else None,
        class="version-new"
    ) }}
</div>

{% elif s1 or s2 %}
{{ banner("!", "One Section Not Found",
    (title1 ~ " CFR &sect; " ~ section1 if not s1 else title2 ~ " CFR &sect; " ~ section2) ~ " could not be found.",
    class="partial-data") }}

{% set found = s1 or s2 %}
{% set found_title = title1 if s1 else title2 %}
{% set found_section = section1 if s1 else section2 %}
{{ version_card(
    section=found,
    label=found_title ~ " CFR &sect; " ~ found_section,
    link=url_for('browse.section', title_num=found_title, section=found_section, year=year),
    show_heading=True,
    class="single-version"
) }}

{% else %}
{{ banner("&#x2717;", "Sections Not Found", "Neither section could be found in the database.", class="not-found") }}
{% endif %}

<div class="compare-back-link">
    <a href="{{ url_for('compare.index') }}" role="button" class="outline">&#x2190; Back to Compare</a>
</div>
{% endblock %}
