{% extends "base.html" %}

{% block title %}Statistics - Lens{% endblock %}

{% block content %}
<hgroup>
    <h1>Statistics</h1>
    <p>Overview of the Code of Federal Regulations</p>
</hgroup>

<!-- Aggregate Statistics Cards -->
<div class="aggregate-stats">
    <div class="stat-card">
        <div class="stat-value">{{ "{:,.0f}".format(aggregate.total_words / 1000000) }}M</div>
        <div class="stat-label">Total Words</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ "{:,}".format(aggregate.total_sections) }}</div>
        <div class="stat-label">Sections</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ aggregate.total_titles }}</div>
        <div class="stat-label">Titles</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ aggregate.total_agencies }}</div>
        <div class="stat-label">Agencies</div>
    </div>
    <div class="stat-card {% if aggregate.change_pct and aggregate.change_pct > 0 %}stat-increase{% elif aggregate.change_pct and aggregate.change_pct < 0 %}stat-decrease{% endif %}">
        <div class="stat-value">{% if aggregate.change_pct %}{{ "{:+.1f}%".format(aggregate.change_pct) }}{% else %}â€”{% endif %}</div>
        <div class="stat-label">Since {{ aggregate.baseline_year }}</div>
    </div>
</div>

<div class="grid">
    <article>
        <header>
            <strong>Top Agencies by Word Count</strong>
        </header>
        <table class="preview-table no-hover">
            <tbody>
                {% for agency in top_agencies %}
                <tr>
                    <td><a href="{{ url_for('statistics.agency_detail', slug=agency.slug) }}">{{ agency.name }}</a></td>
                    <td class="numeric">{{ "{:,}".format(agency.word_count) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <a href="{{ url_for('statistics.agencies') }}" class="view-all-link">View all agencies &rarr;</a>
    </article>

    <article>
        <header>
            <strong>Top Titles by Word Count</strong>
        </header>
        <table class="preview-table no-hover">
            <tbody>
                {% for title in top_titles %}
                <tr>
                    <td><a href="{{ url_for('browse.title', title_num=title.number) }}">{{ title.name }}</a></td>
                    <td class="numeric">{{ "{:,}".format(title.word_count) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <a href="{{ url_for('statistics.titles') }}" class="view-all-link">View all titles &rarr;</a>
    </article>

    <article>
        <header>
            <strong>Compare Sections</strong>
        </header>
        <p>Compare how CFR sections have changed over time with side-by-side diffs.</p>
        <a href="{{ url_for('compare.index') }}" role="button">Compare Sections</a>
    </article>
</div>
{% endblock %}
