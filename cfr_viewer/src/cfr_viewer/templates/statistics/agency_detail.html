{% extends "base.html" %}

{% block title %}{{ agency.name if agency else "Agency Not Found" }} - CFR Viewer{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ul>
        <li><a href="{{ url_for('statistics.index') }}">Statistics</a></li>
        <li><a href="{{ url_for('statistics.agencies') }}">Agencies</a></li>
        <li>{{ agency.name if agency else "Not Found" }}</li>
    </ul>
</nav>

{% if agency %}
<hgroup>
    <h1>{{ agency.name }}</h1>
    {% if agency.short_name %}
    <p>{{ agency.short_name }}</p>
    {% endif %}
</hgroup>

<h2>CFR Chapters</h2>

{% if chapter_stats %}
<table class="striped">
    <thead>
        <tr>
            <th class="sortable-header" data-sort="number">Title</th>
            <th class="sortable-header" data-sort="string">Chapter</th>
            <th class="sortable-header numeric" data-sort="number">Word Count</th>
            <th class="sortable-header numeric" data-sort="number">Since 2010</th>
        </tr>
    </thead>
    <tbody>
        {% for ch in chapter_stats %}
        <tr>
            <td data-value="{{ ch.title }}"><a href="{{ url_for('browse.title', title_num=ch.title) }}#chapter-{{ ch.chapter }}">{{ ch.title }}</a></td>
            <td><a href="{{ url_for('browse.title', title_num=ch.title) }}#chapter-{{ ch.chapter }}">{{ ch.chapter }}</a></td>
            <td class="numeric" data-value="{{ ch.word_count }}">{{ "{:,}".format(ch.word_count) }}</td>
            <td class="numeric {% if ch.change_pct and ch.change_pct > 0 %}change-positive{% elif ch.change_pct and ch.change_pct < 0 %}change-negative{% else %}change-zero{% endif %}" data-value="{{ ch.change_pct or 0 }}">{% if ch.change_pct is not none %}{{ "{:+.1f}%".format(ch.change_pct) }}{% else %}â€”{% endif %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No CFR chapters associated with this agency.</p>
{% endif %}

{% else %}
<h1>Agency Not Found</h1>
<p>The requested agency could not be found.</p>
{% endif %}
{% endblock %}
